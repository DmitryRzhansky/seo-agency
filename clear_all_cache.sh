#!/bin/bash

echo "üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è..."

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Django
echo "–û—á–∏—â–∞–µ–º –∫—ç—à Django..."
python manage.py clear_cache 2>/dev/null || echo "–ö–æ–º–∞–Ω–¥–∞ clear_cache –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
echo "–ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã..."
python manage.py collectstatic --noinput

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
echo "–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Redis..."
redis-cli FLUSHALL 2>/dev/null || echo "Redis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ nginx
echo "–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ nginx..."
sudo rm -rf /var/cache/nginx/* 2>/dev/null || echo "–ö—ç—à nginx –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"

echo "‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω–æ –∏ –æ—á–∏—â–µ–Ω–æ!"
echo ""
echo "üìã –ß—Ç–æ –±—ã–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ:"
echo "   ‚úÖ Nginx –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç–∞—Ç–∏–∫–∞, –º–µ–¥–∏–∞, —Å—Ç—Ä–∞–Ω–∏—Ü—ã)"
echo "   ‚úÖ Django Redis –∫—ç—à (–∑–∞–º–µ–Ω–µ–Ω –Ω–∞ DummyCache)"
echo "   ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã @cache_page –≤–æ –≤—Å–µ—Ö views"
echo "   ‚úÖ Middleware –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è"
echo "   ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ Cache-Control –¥–ª—è –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤"
echo ""
echo "üîÑ –¢–µ–ø–µ—Ä—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É!"
