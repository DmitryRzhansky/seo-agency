{% extends "main/base.html" %}
{% load static %}
{% load seo_tags %}

{% block title %}{{ author.get_full_name }}{% endblock title %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <div class="container">
        <a href="{% url 'main:home' %}">Главная</a><span class="separator">/</span><span class="current">{{ author.get_full_name }}</span>
    </div>
</div>
{% endblock breadcrumbs %}

{% block content %}

<!-- Профиль автора -->
<section class="content-section">
    <div class="container">
        <div class="author-profile">
            {% if author.profile.avatar %}
            <img src="{{ author.profile.avatar.url }}" alt="{{ author.get_full_name }}" class="author-avatar">
            {% else %}
            <div class="author-avatar-placeholder">
                <i class="fas fa-user"></i>
            </div>
            {% endif %}
            
            <div class="author-info">
                <h2>{{ author.get_full_name }}</h2>
                {% if author.profile.role %}
                <div class="author-role">{{ author.profile.role }}</div>
                {% elif author.is_staff %}
                <div class="author-role">Автор блога</div>
                {% endif %}
                
                {% if author.profile.bio %}
                <div class="author-bio">
                    {{ author.profile.bio|linebreaks }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Статистика автора -->
<section class="content-section alt-bg">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Статистика</h2>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ total_posts|default:posts.count }}</div>
                <div class="stat-label">Статей опубликовано</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">{% if first_published %}{{ first_published|date:"Y" }}{% else %}-{% endif %}</div>
                <div class="stat-label">Первая публикация</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">{% if last_published %}{{ last_published|date:"d.m" }}{% else %}-{% endif %}</div>
                <div class="stat-label">Последняя публикация</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">{{ total_read_time|default:0 }}</div>
                <div class="stat-label">Минут чтения</div>
            </div>
        </div>
    </div>
</section>

<!-- Категории статей -->
{% if categories_stats %}
<section class="content-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Категории статей</h2>
        </div>
        <div class="content-grid">
            {% for category, count in categories_stats.items %}
            <div class="content-card">
                <h3 class="content-card-title">
                    <a href="{% url 'blog:category_posts' slug=category.slug %}">{{ category.name }}</a>
                </h3>
                <div style="font-size: 32px; font-weight: 900; color: var(--accent); margin: 20px 0; font-family: var(--font-mono);">
                    {{ count }}
                </div>
                <p class="content-card-text">статей в категории</p>
                <a href="{% url 'blog:category_posts' slug=category.slug %}" class="content-card-link">
                    <span>Смотреть</span>
                    <span class="arrow">→</span>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Статьи автора -->
{% if posts %}
<section class="content-section alt-bg">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Статьи автора</h2>
        </div>
        <div class="content-grid">
            {% for post in posts %}
            <article class="content-card">
                {% if post.image %}
                <img src="{{ post.image.url }}" class="content-card-image" alt="{{ post.title }}">
                {% else %}
                <div class="content-card-placeholder">
                    <i class="fas fa-newspaper"></i>
                </div>
                {% endif %}
                {% if post.category %}<div class="content-card-meta">{{ post.category.name }}</div>{% endif %}
                <h3 class="content-card-title"><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
                <p class="content-card-text">{{ post.excerpt|default:post.content|striptags|truncatewords:20 }}</p>
                <div class="content-card-footer">
                    <div class="content-card-info">
                        <span>{{ post.published_date|date:"d.m.Y" }}</span>
                        {% if post.read_time %}<span>{{ post.read_time }} мин</span>{% endif %}
                    </div>
                    <a href="{{ post.get_absolute_url }}" class="content-card-link"><span>Читать</span><span class="arrow">→</span></a>
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</section>
{% else %}
<section class="content-section">
    <div class="container">
        <div class="empty-state">
            <i class="fas fa-newspaper"></i>
            <h3>Пока нет статей</h3>
            <p>Этот автор ещё не опубликовал ни одной статьи.</p>
        </div>
    </div>
</section>
{% endif %}

<!-- CTA -->
<section class="cta-section">
    <div class="container">
        <div class="cta-section-content">
            <h2 class="cta-section-title">Хотите стать автором?</h2>
            <p class="cta-section-text">
                Если у вас есть экспертиза в SEO и digital-маркетинге, мы будем рады видеть вас в нашей команде авторов
            </p>
            <div class="cta-section-buttons">
                <a href="{% url 'main:contacts' %}" class="cta-section-button">
                    <span>Связаться с нами</span>
                </a>
            </div>
        </div>
    </div>
</section>

{% endblock content %}
