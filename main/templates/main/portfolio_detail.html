{% extends "main/base.html" %}
{% load seo_tags %}
{% load static %}

{% block title %}{{ title }}{% endblock title %}

{% block breadcrumbs %}
{% if portfolio_item.show_breadcrumbs %}
<nav class="breadcrumb-nav">
    <div class="container">
        <ol class="breadcrumb">
            {% for breadcrumb in portfolio_item.get_breadcrumbs %}
            {% if forloop.last %}
            <li class="breadcrumb-item active">{{ breadcrumb.title }}</li>
            {% else %}
            <li class="breadcrumb-item"><a href="{{ breadcrumb.url }}">{{ breadcrumb.title }}</a></li>
            {% endif %}
            {% endfor %}
        </ol>
    </div>
</nav>
{% endif %}
{% endblock breadcrumbs %}

{% block content %}
<!-- Hero секция проекта -->
<section class="project-hero">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="project-meta mb-3">
                    <span class="badge bg-primary me-2">{{ portfolio_item.get_project_type_display_ru }}</span>
                    {% if portfolio_item.client_name %}
                    <span class="text-muted">{{ portfolio_item.client_name }}</span>
                    {% endif %}
                </div>
                <h1 class="display-4 fw-bold mb-3">{{ portfolio_item.title }}</h1>
                <p class="lead mb-4">{{ portfolio_item.short_description }}</p>
                {% if portfolio_item.project_url %}
                <a href="{{ portfolio_item.project_url }}" target="_blank" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-external-link-alt me-2"></i>
                    Посмотреть проект
                </a>
                {% endif %}
                <a href="{% url 'main:contacts' %}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-handshake me-2"></i>
                    Обсудить проект
                </a>
            </div>
            <div class="col-lg-6 mt-4 mt-lg-0">
                <div class="project-image">
                    {% if portfolio_item.main_image %}
                    <img src="{{ portfolio_item.main_image.url }}" alt="{{ portfolio_item.get_main_image_alt }}" class="img-fluid rounded">
                    {% else %}
                    <div class="no-image-placeholder">
                        <i class="fas fa-image fa-5x text-muted"></i>
                        <p class="text-muted mt-3">Изображение отсутствует</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Описание проекта -->
<section class="section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="project-description">
                    <h2 class="mb-4">О проекте</h2>
                    <div class="content">
                        {{ portfolio_item.full_description|safe }}
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="project-sidebar">
                    <!-- Результаты проекта -->
                    {% if portfolio_item.get_results_list %}
                    <div class="sidebar-card mb-4">
                        <h3 class="sidebar-title">Результаты</h3>
                        <div class="results-list">
                            {% for result in portfolio_item.get_results_list %}
                            <div class="result-item">
                                <div class="result-metric">{{ result.metric }}</div>
                                <div class="result-value">{{ result.value }}</div>
                                {% if result.description %}
                                <div class="result-description">{{ result.description }}</div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Технологии -->
                    {% if portfolio_item.get_technologies_list %}
                    <div class="sidebar-card mb-4">
                        <h3 class="sidebar-title">Технологии</h3>
                        <div class="technologies-list">
                            {% for tech in portfolio_item.get_technologies_list %}
                            <span class="badge bg-secondary me-2 mb-2">{{ tech }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Информация о проекте -->
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Информация</h3>
                        <div class="project-info">
                            <div class="info-item">
                                <strong>Тип проекта:</strong>
                                <span>{{ portfolio_item.get_project_type_display_ru }}</span>
                            </div>
                            {% if portfolio_item.client_name %}
                            <div class="info-item">
                                <strong>Клиент:</strong>
                                <span>{{ portfolio_item.client_name }}</span>
                            </div>
                            {% endif %}
                            <div class="info-item">
                                <strong>Дата создания:</strong>
                                <span>{{ portfolio_item.created_at|date:"d.m.Y" }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Галерея изображений -->
{% if portfolio_item.get_gallery_images_list %}
<section class="section-padding bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-5">Галерея проекта</h2>
                <div class="row">
                    {% for image_path in portfolio_item.get_gallery_images_list %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="gallery-item">
                            <img src="{{ image_path }}" alt="Изображение проекта {{ portfolio_item.title }}" class="img-fluid rounded">
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Похожие проекты -->
{% if related_projects %}
<section class="section-padding">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-5">Похожие проекты</h2>
                <div class="row">
                    {% for project in related_projects %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="portfolio-card">
                            <div class="portfolio-image">
                                {% if project.main_image %}
                                <img src="{{ project.main_image.url }}" alt="{{ project.get_main_image_alt }}" class="img-fluid">
                                {% else %}
                                <div class="no-image-placeholder">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                    <p class="text-muted mt-2">Изображение отсутствует</p>
                                </div>
                                {% endif %}
                                <div class="portfolio-overlay">
                                    <div class="portfolio-actions">
                                        <a href="{{ project.get_absolute_url }}" class="btn btn-primary">
                                            <i class="fas fa-eye me-2"></i>
                                            Подробнее
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="portfolio-content">
                                <div class="portfolio-meta">
                                    <span class="badge bg-primary">{{ project.get_project_type_display_ru }}</span>
                                    {% if project.client_name %}
                                    <span class="text-muted">{{ project.client_name }}</span>
                                    {% endif %}
                                </div>
                                <h3 class="portfolio-title">
                                    <a href="{{ project.get_absolute_url }}">{{ project.title }}</a>
                                </h3>
                                <p class="portfolio-description">{{ project.short_description }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- CTA секция -->
<section class="section-padding bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h2 class="mb-3">Заинтересовал проект?</h2>
                <p class="lead mb-0">Свяжитесь с нами, и мы обсудим, как можем реализовать похожий проект для вашего бизнеса.</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'main:contacts' %}" class="btn btn-light btn-lg">
                    <i class="fas fa-phone me-2"></i>
                    Обсудить проект
                </a>
            </div>
        </div>
    </div>
</section>

<style>
/* Стили для детальной страницы проекта */
.project-hero {
    padding: 4rem 0;
    background: linear-gradient(135deg, var(--bs-bg-darker) 0%, var(--bs-bg-dark) 100%);
}

.project-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.project-image img {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease;
}

.project-image img:hover {
    transform: scale(1.02);
}

.no-image-placeholder {
    width: 100%;
    height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--bs-bg-darker);
    color: var(--bs-text-muted-dark);
    border-radius: 10px;
}

.project-description .content {
    color: var(--bs-text-dark);
    line-height: 1.8;
}

.project-description .content h1,
.project-description .content h2,
.project-description .content h3,
.project-description .content h4,
.project-description .content h5,
.project-description .content h6 {
    color: var(--bs-text-dark);
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.project-description .content p {
    margin-bottom: 1.5rem;
}

.project-description .content ul,
.project-description .content ol {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
}

.project-description .content li {
    margin-bottom: 0.5rem;
}

.sidebar-card {
    background: linear-gradient(135deg, var(--bs-bg-darker) 0%, var(--bs-bg-dark) 100%);
    border: 1px solid var(--bs-border-dark);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.sidebar-title {
    color: var(--bs-text-dark);
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--bs-primary);
}

.results-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.result-item {
    padding: 1rem;
    background: var(--bs-bg-darker);
    border-radius: 10px;
    border-left: 4px solid var(--bs-primary);
}

.result-metric {
    font-weight: 600;
    color: var(--bs-text-dark);
    margin-bottom: 0.25rem;
}

.result-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--bs-primary);
    margin-bottom: 0.25rem;
}

.result-description {
    color: var(--bs-text-muted-dark);
    font-size: 0.9rem;
}

.technologies-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.project-info {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--bs-border-dark);
}

.info-item:last-child {
    border-bottom: none;
}

.info-item strong {
    color: var(--bs-text-dark);
}

.info-item span {
    color: var(--bs-text-muted-dark);
}

.gallery-item img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    transition: transform 0.3s ease;
    cursor: pointer;
}

.gallery-item img:hover {
    transform: scale(1.05);
}

.portfolio-card {
    background: linear-gradient(135deg, var(--bs-bg-darker) 0%, var(--bs-bg-dark) 100%);
    border: 1px solid var(--bs-border-dark);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    height: 100%;
}

.portfolio-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.portfolio-image {
    position: relative;
    overflow: hidden;
    height: 200px;
}

.portfolio-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.portfolio-card:hover .portfolio-image img {
    transform: scale(1.05);
}

.portfolio-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.portfolio-card:hover .portfolio-overlay {
    opacity: 1;
}

.portfolio-actions .btn {
    transform: translateY(20px);
    transition: transform 0.3s ease;
}

.portfolio-card:hover .portfolio-actions .btn {
    transform: translateY(0);
}

.portfolio-content {
    padding: 1.5rem;
}

.portfolio-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.portfolio-title {
    margin-bottom: 1rem;
}

.portfolio-title a {
    color: var(--bs-text-dark);
    text-decoration: none;
    transition: color 0.3s ease;
}

.portfolio-title a:hover {
    color: var(--bs-primary);
}

.portfolio-description {
    color: var(--bs-text-muted-dark);
    margin-bottom: 0;
    line-height: 1.6;
}

@media (max-width: 768px) {
    .project-hero {
        padding: 2rem 0;
    }
    
    .sidebar-card {
        margin-bottom: 2rem;
    }
    
    .gallery-item img {
        height: 200px;
    }
}
</style>
{% endblock content %}
