{% load static %}
{% load seo_tags %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="ru" itemscope itemtype="http://schema.org/WebPage">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    {% block seo_meta %}
        {% if seo_object %}
            {% seo_meta_tags seo_object title "–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ SEO –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —Å–∞–π—Ç–æ–≤" %}
        {% else %}
            <title>{% block title %}{{ title }}{% endblock title %} | –ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü</title>
            <meta name="description" content="{% block description %}–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ SEO –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —Å–∞–π—Ç–æ–≤. 247 –ø—Ä–æ–µ–∫—Ç–æ–≤, 98% –≤ –¢–û–ü-10. –ì–∞—Ä–∞–Ω—Ç–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.{% endblock description %}">
        {% endif %}
    {% endblock seo_meta %}

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ HTML-—Ç–µ–≥–∏ - –æ—á–µ–Ω—å —Ä–∞–Ω–æ -->
    {% block custom_head_scripts_very_early %}
        {% get_custom_head_scripts page_type page_slug 'very_early' as custom_scripts %}
        {% for script in custom_scripts %}
            {{ script.html_content|safe }}
        {% endfor %}
    {% endblock custom_head_scripts_very_early %}

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ HTML-—Ç–µ–≥–∏ - —Ä–∞–Ω–æ -->
    {% block custom_head_scripts_early %}
        {% get_custom_head_scripts page_type page_slug 'early' as custom_scripts %}
        {% for script in custom_scripts %}
            {{ script.html_content|safe }}
        {% endfor %}
    {% endblock custom_head_scripts_early %}

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ HTML-—Ç–µ–≥–∏ - –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ -->
    {% block custom_head_scripts_middle %}
        {% get_custom_head_scripts page_type page_slug 'middle' as custom_scripts %}
        {% for script in custom_scripts %}
            {{ script.html_content|safe }}
        {% endfor %}
    {% endblock custom_head_scripts_middle %}

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ HTML-—Ç–µ–≥–∏ - –ø–æ–∑–¥–Ω–æ -->
    {% block custom_head_scripts_late %}
        {% get_custom_head_scripts page_type page_slug 'late' as custom_scripts %}
        {% for script in custom_scripts %}
            {{ script.html_content|safe }}
        {% endfor %}
    {% endblock custom_head_scripts_late %}

    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700;900&family=JetBrains+Mono:wght@400;700;900&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    {% block extra_css %}{% endblock extra_css %}

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ HTML-—Ç–µ–≥–∏ - –æ—á–µ–Ω—å –ø–æ–∑–¥–Ω–æ -->
    {% block custom_head_scripts_very_late %}
        {% get_custom_head_scripts page_type page_slug 'very_late' as custom_scripts %}
        {% for script in custom_scripts %}
            {{ script.html_content|safe }}
        {% endfor %}
    {% endblock custom_head_scripts_very_late %}
</head>
<body>
    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div class="preloader" id="preloader">
        <div class="preloader-content">
            <div class="preloader-logo">
                <img src="{% static 'images/logo/logo_color_transparent.png' %}" alt="Logo" class="logo-img">
            </div>
            <div class="preloader-bar">
                <div class="bar-progress"></div>
            </div>
            <div class="preloader-percent">
                <span id="percentText">0%</span>
            </div>
        </div>
    </div>

    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä—Å–æ—Ä -->
    <div class="custom-cursor"></div>
    <div class="cursor-follower"></div>
    
    <!-- –®—É–º –∏ —Ç–µ–∫—Å—Ç—É—Ä–∞ —Ñ–æ–Ω–∞ -->
    <div class="noise-overlay"></div>
    
    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–∫—Ä–æ–ª–ª–∞ -->
    <div class="scroll-progress"></div>

    <!-- –ü–ª–∞–≤–∞—é—â–∏–π –±–∞–Ω–Ω–µ—Ä —Å –∞–∫—Ü–∏–µ–π -->
    <div class="floating-promo" id="floatingPromo">
        <button class="promo-close" id="promoClose">√ó</button>
        <div class="promo-content">
            <div class="promo-badge">üî• –ê–ö–¶–ò–Ø</div>
            <div class="promo-title">–°–∫–∏–¥–∫–∞ 50%</div>
            <div class="promo-subtitle">–Ω–∞&nbsp;SEO&#8209;–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ</div>
            <div class="promo-timer" id="promoTimer">
                <span class="timer-label">–î–æ&nbsp;–∫–æ–Ω—Ü–∞ –∞–∫—Ü–∏–∏:</span>
                <span class="timer-value" id="timerValue">02:45:30</span>
            </div>
            <button class="promo-btn" id="promoCTA">–ü–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É</button>
        </div>
    </div>
    
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <div class="city-selector">
                    <span class="city-icon">üìç</span>
                    <select id="citySelect" class="city-select" onchange="handleCityChange(this)">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                        <option value="all">–í—Å–µ –≥–æ—Ä–æ–¥–∞</option>
                        {% for city in cities_menu %}
                        <option value="{{ city.slug }}" {% if current_city and current_city.slug == city.slug %}selected{% endif %}>{{ city.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <a href="tel:+79636415944" class="top-phone">
                    <span class="phone-icon">üìû</span>
                    <span>+7 (963) 641-59-44</span>
                </a>
            </div>
            <div class="top-bar-right">
                <button class="top-btn" id="callbackBtn">–ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
                <button class="top-btn primary" id="proposalBtn">–ü–æ–ª—É—á–∏—Ç—å –ö–ü</button>
            </div>
        </div>
    </div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                {% if page_type == 'home' %}
                <img src="{% static 'images/logo/sign.png' %}" alt="–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü" class="nav-logo">
                <span class="brand-name">–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü</span>
                {% else %}
                <a href="{% url 'main:home' %}">
                    <img src="{% static 'images/logo/sign.png' %}" alt="–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü" class="nav-logo">
                    <span class="brand-name">–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü</span>
                </a>
                {% endif %}
            </div>
            <ul class="nav-menu">
                <li><a href="{% url 'services:service_list' %}">–£—Å–ª—É–≥–∏</a></li>
                <li><a href="{% url 'main:portfolio_list' %}">–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ</a></li>
                <li><a href="{% url 'blog:post_list' %}">–ë–ª–æ–≥</a></li>
                <li><a href="{% url 'main:contacts' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
            </ul>
            <button class="menu-toggle" id="menuToggle">‚ò∞</button>
        </div>
    </nav>

    <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    {% block breadcrumbs %}
    {% if page_type != 'home' %}
    <div class="breadcrumbs">
        <div class="container">
            <a href="{% url 'main:home' %}">–ì–ª–∞–≤–Ω–∞—è</a>
            <span class="separator">/</span>
            <span class="current">{% block breadcrumb_current %}{{ title }}{% endblock breadcrumb_current %}</span>
        </div>
    </div>
    {% endif %}
    {% endblock breadcrumbs %}

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main>
        {% block content %}{% endblock content %}
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="footer-pattern"></div>
        <div class="container">
            <div class="footer-main">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <img src="{% static 'images/logo/logo_color_transparent.png' %}" alt="–ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü" class="footer-logo-img">
                    </div>
                    <p class="footer-tagline">–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —Å–∞–π—Ç–æ–≤<br>—Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</p>
                </div>
                <div class="footer-links-group">
                    <div class="footer-column">
                        <h4>–£—Å–ª—É–≥–∏</h4>
                        <ul>
                            {% for category in service_categories_menu %}
                            <li><a href="{% url 'services:service_category' category.slug %}">{{ category.title }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>–ö–æ–º–ø–∞–Ω–∏—è</h4>
                        <ul>
                            <li><a href="{% url 'main:portfolio_list' %}">–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ</a></li>
                            <li><a href="{% url 'main:contacts' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>–†–µ—Å—É—Ä—Å—ã</h4>
                        <ul>
                            <li><a href="{% url 'main:sitemap' %}">–ö–∞—Ä—Ç–∞ —Å–∞–π—Ç–∞</a></li>
                            <li><a href="{% url 'main:faq_list' %}">–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</a></li>
                            <li><a href="{% url 'main:glossary_list' %}">–ì–ª–æ—Å—Å–∞—Ä–∏–π</a></li>
                            <li><a href="{% url 'blog:post_list' %}">–ë–ª–æ–≥</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                        <ul>
                            <li><a href="mailto:isakov@isakov.work">isakov@isakov.work</a></li>
                            <li><a href="tel:+79636415944">+7 (963) 641-59-44</a></li>
                            <li>–ø–Ω-–ø—Ç: 10:00 - 19:00</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-legal">
                    <p>¬© 2015-2025. –ó–∞ –¥–µ–Ω—å–≥–∏ –≤ –¢–û–ü</p>
                    <div class="legal-links">
                        <a href="{% url 'main:privacy_policy' %}">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                    </div>
                </div>
                <div class="footer-social">
                    <span>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–∞–º–∏:</span>
                    <div class="social-icons">
                        <a href="https://t.me/vitaly_seo_expert" class="social-icon">TG</a>
                        <a href="https://vk.com/vitaly_seo_expert" class="social-icon">VK</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-requisites">
            <div class="container">
                <div class="requisites-grid">
                    <div class="requisites-column">
                        <h5>–†–µ–∫–≤–∏–∑–∏—Ç—ã</h5>
                        <p>–ò–ü –õ–∞–∫–∏–Ω –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤–∏—á</p>
                        <p>–ò–ù–ù: 615524775085</p>
                    </div>
                    <div class="requisites-column">
                        <h5>–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</h5>
                        <p>–†/–°: 40802810102870022448</p>
                        <p>–ë–ò–ö: 044525593</p>
                        <p>–ë–∞–Ω–∫: –ê–û "–ê–õ–¨–§–ê-–ë–ê–ù–ö"</p>
                        <p>–ö/–°: 30101810200000000593</p>
                    </div>
                    <div class="requisites-column">
                        <h5>–ê–¥—Ä–µ—Å</h5>
                        <p>—É–ª–∏—Ü–∞ –ì–∞–π–¥–∞—Ä–∞, –¥. 10–≤, –∫–≤./–æ—Ñ. 57</p>
                        <p>–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥. –ü–æ–¥–æ–ª—å—Å–∫</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-signature">
            <div class="container">
                <span id="renderSpeed">–†–µ–Ω–¥–µ—Ä–∏–Ω–≥: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ...</span>
            </div>
        </div>
    </footer>

    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–≤–µ—Ä—Ö -->
    <button class="scroll-to-top" id="scrollToTop">
        <span>‚Üë</span>
    </button>

    <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ —Å–∫–∏–¥–∫–∏ -->
    <button class="discount-btn" id="discountBtn">
        –°–∫–∏–¥–∫–∞ 50% –Ω–∞ SEO
    </button>

    <!-- Cookie —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="cookie-notice" id="cookieNotice">
        <div class="cookie-content">
            <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞. –ü—Ä–æ–¥–æ–ª–∂–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–π—Ç, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º cookies.</p>
            <button class="cookie-btn" id="acceptCookie">–ü—Ä–∏–Ω—è—Ç—å</button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{% static 'js/base.js' %}"></script>
    <script src="{% static 'js/script.js' %}"></script>
    
    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ —Å –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π —Ñ–æ—Ä–º–æ–π -->
    <div id="contactModal" class="contact-modal" style="display:none; position: fixed; inset: 0; z-index: 9999;">
        <div class="contact-modal-backdrop" data-close-modal style="position:absolute; inset:0; background: rgba(0,0,0,0.6);"></div>
        <div class="contact-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="contactModalTitle"
             style="position:relative; width: 100%; max-width: 640px; margin: 8vh auto; background:#fff; border: 3px solid #000; box-shadow: 12px 12px 0 #000;">
            <button type="button" class="contact-modal-close" data-close-modal
                    style="position:absolute; top:10px; right:10px; width:36px; height:36px; border:3px solid #000; background:#fff; cursor:pointer; font-weight:900;">√ó</button>
            <div class="contact-modal-header" style="padding:24px 24px 0 24px;">
                <h3 id="contactModalTitle" style="margin:0 40px 16px 0; font-weight:900; font-size:28px;">–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏</h3>
                <p style="margin:0 40px 10px 0; color:#2A2A2A;">–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –æ—Ç–≤–µ—Ç–∏–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
            </div>
            <div class="contact-modal-body" style="padding: 0 24px 24px 24px;">
                <form id="contactModalForm" class="contact-form" method="post" action="{% url 'main:home' %}">
                    {% csrf_token %}
                    <div class="form-group" style="margin-bottom:12px;">
                        <label for="modal_name">–ò–º—è</label>
                        <input type="text" id="modal_name" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required style="width:100%; border:3px solid #000; padding:12px;">
                    </div>
                    <div class="form-group" style="margin-bottom:12px;">
                        <label for="modal_email">Email</label>
                        <input type="email" id="modal_email" name="email" placeholder="example@mail.ru" required style="width:100%; border:3px solid #000; padding:12px;">
                    </div>
                    <div class="form-group" style="margin-bottom:12px;">
                        <label for="modal_phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="modal_phone" name="phone" placeholder="+7 (___) ___-__-__" required style="width:100%; border:3px solid #000; padding:12px;">
                    </div>
                    <div class="form-group" style="margin-bottom:16px;">
                        <label for="modal_message">–ö—Ä–∞—Ç–∫–æ –æ –∑–∞–¥–∞—á–µ</label>
                        <textarea id="modal_message" name="message" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É..." required style="width:100%; border:3px solid #000; padding:12px;"></textarea>
                    </div>
                    <input type="hidden" name="_source" value="contact_modal">
                    <button type="submit" class="submit-button" style="display:inline-flex; align-items:center; gap:8px; border:3px solid #000; background:#3cc33c; color:#000; padding:12px 16px; font-weight:900; cursor:pointer;">
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</span>
                        <span>‚Üí</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ -->
    <script>
        console.log('Inline script loaded');
        
        function handleCityChange(selectElement) {
            console.log('City change handler called');
            const selectedCitySlug = selectElement.value;
            console.log('Selected city:', selectedCitySlug);
            
            if (selectedCitySlug && selectedCitySlug !== '') {
                if (selectedCitySlug === 'all') {
                    console.log('Redirecting to all cities');
                    window.location.href = '/cities/';
                } else {
                    console.log('Redirecting to city:', selectedCitySlug);
                    window.location.href = '/set-city/' + selectedCitySlug + '/';
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            const citySelect = document.getElementById('citySelect');
            console.log('City select found:', citySelect);
            
            if (citySelect) {
                console.log('City select has', citySelect.options.length, 'options');
            }
            
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞: –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–Ω–æ–ø–∫–∞–º –≤ —Ç–æ–ø-–±–∞—Ä–µ
            const contactModal = document.getElementById('contactModal');
            const openButtons = [
                document.getElementById('callbackBtn'),
                document.getElementById('proposalBtn')
            ].filter(Boolean);
            const closeSelectors = '[data-close-modal]';
            const openModal = () => { if (contactModal) contactModal.style.display = 'block'; };
            const closeModal = () => { if (contactModal) contactModal.style.display = 'none'; };
            openButtons.forEach(btn => btn.addEventListener('click', (e) => { e.preventDefault(); openModal(); }));
            if (contactModal) {
                contactModal.querySelectorAll(closeSelectors).forEach(el => el.addEventListener('click', closeModal));
            }
        });
    </script>
    
    {% block extra_js %}{% endblock extra_js %}
</body>
</html>