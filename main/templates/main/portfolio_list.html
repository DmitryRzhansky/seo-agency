{% extends "main/base.html" %}
{% load static %}
{% load seo_tags %}
{% load custom_filters %}

{% block title %}{{ title }}{% endblock title %}

{% block breadcrumbs %}
<nav class="breadcrumb-nav">
    <div class="container">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'main:home' %}">Главная</a></li>
            <li class="breadcrumb-item active">Портфолио</li>
        </ol>
    </div>
</nav>
{% endblock breadcrumbs %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/portfolio-modern.css' %}">
{% endblock extra_css %}

{% block content %}

<!-- Hero секция портфолио -->
<section class="portfolio-hero-modern">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="portfolio-hero-content">
                    <h1 class="portfolio-hero-title">Наши работы</h1>
                    <p class="portfolio-hero-subtitle">Примеры успешных проектов, которые мы реализовали для наших клиентов. Каждый проект - это результат профессионального подхода и глубокого понимания задач бизнеса.</p>
                </div>
            </div>
            <div class="col-lg-4 mt-4 mt-lg-0 d-flex justify-content-center align-items-center">
                <div class="portfolio-hero-visual">
                    <div class="portfolio-floating-elements">
                        <div class="portfolio-floating-element element-1">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div class="portfolio-floating-element element-2">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="portfolio-floating-element element-3">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="portfolio-floating-element element-4">
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <i class="fas fa-briefcase portfolio-hero-icon"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Рекомендуемые проекты -->
{% if featured_page_obj %}
<section class="section-modern">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-5" style="color: #ffffff; font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #6366f1, #ec4899); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Рекомендуемые проекты</h2>
                
                <!-- Сетка рекомендуемых проектов -->
                <div class="portfolio-grid-modern">
                    {% for project in featured_page_obj %}
                    <div class="portfolio-card-modern">
                        <div class="portfolio-card-image-container">
                            {% if project.main_image %}
                            <img src="{{ project.main_image.url }}" alt="{{ project.get_main_image_alt }}" class="portfolio-card-image">
                            {% else %}
                            <div class="portfolio-card-placeholder">
                                <i class="fas fa-image portfolio-placeholder-icon"></i>
                            </div>
                            {% endif %}
                            <div class="portfolio-card-overlay">
                                <div class="portfolio-card-actions">
                                    <a href="{{ project.get_absolute_url }}" class="portfolio-card-btn">
                                        <i class="fas fa-eye me-2"></i>Подробнее
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="portfolio-card-content">
                            <div class="portfolio-card-meta">
                                <div class="portfolio-card-type">{{ project.get_project_type_display_ru }}</div>
                                {% if project.client_name %}
                                <div class="portfolio-card-client">{{ project.client_name }}</div>
                                {% endif %}
                            </div>
                            <h3 class="portfolio-card-title">
                                <a href="{{ project.get_absolute_url }}">{{ project.title }}</a>
                            </h3>
                            <p class="portfolio-card-description">{{ project.short_description }}</p>
                            
                            <!-- Результаты проекта -->
                            {% if project.get_results_list %}
                            <div class="portfolio-card-results">
                                <h6>Результаты:</h6>
                                <div class="portfolio-results-grid">
                                    {% for result in project.get_results_list|slice:":2" %}
                                    <div class="portfolio-result-item">
                                        <div class="portfolio-result-value">{{ result.value }}</div>
                                        <div class="portfolio-result-metric">{{ result.metric }}</div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <a href="{{ project.get_absolute_url }}" class="portfolio-card-link">
                                Смотреть проект <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Пагинация для рекомендуемых проектов -->
                {% if is_featured_paginated %}
                <div class="portfolio-pagination-modern">
                    {% if featured_page_obj.has_previous %}
                        <a href="?featured_page=1{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            <i class="fas fa-chevron-left me-1"></i>Первая
                        </a>
                        <a href="?featured_page={{ featured_page_obj.previous_page_number }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            <i class="fas fa-chevron-left me-1"></i>Предыдущая
                        </a>
                    {% endif %}

                    {% for num in featured_page_obj.paginator.page_range %}
                        {% if featured_page_obj.number == num %}
                            <span class="portfolio-page-link-modern active">{{ num }}</span>
                        {% elif num > featured_page_obj.number|add:'-3' and num < featured_page_obj.number|add:'3' %}
                            <a href="?featured_page={{ num }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if featured_page_obj.has_next %}
                        <a href="?featured_page={{ featured_page_obj.next_page_number }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            Следующая<i class="fas fa-chevron-right ms-1"></i>
                        </a>
                        <a href="?featured_page={{ featured_page_obj.paginator.num_pages }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            Последняя<i class="fas fa-chevron-right ms-1"></i>
                        </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Поиск и фильтры -->
<section class="portfolio-search-modern">
    <div class="container">
        <!-- Поисковая форма -->
        <div class="row justify-content-center mb-4">
            <div class="col-lg-8">
                <form method="get" class="d-flex gap-3" id="search-form">
                    <input type="text" 
                           class="form-control portfolio-search-input-modern" 
                           name="q" 
                           id="search-input"
                           placeholder="Поиск по проектам..." 
                           value="{{ search_query }}"
                           aria-label="Поиск по проектам">
                    <button class="btn portfolio-search-btn-modern" type="submit">
                        <i class="fas fa-search me-2"></i>Найти
                    </button>
                </form>
            </div>
        </div>

        <!-- Фильтр по типам проектов -->
        {% if available_types %}
        <div class="portfolio-filter-tags-modern">
            <a href="{% url 'main:portfolio_list' %}#portfolio" 
               class="portfolio-filter-tag-modern {% if not current_type %}active{% endif %}">
                Все проекты
            </a>
            {% for type_value, type_name in available_types %}
                <a href="{% url 'main:portfolio_list' %}?type={{ type_value }}#portfolio" 
                   class="portfolio-filter-tag-modern {% if current_type == type_value %}active{% endif %}">
                    {{ type_name }}
                </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Информация о поиске -->
        {% if search_query %}
        <div class="row justify-content-center mb-4">
            <div class="col-lg-8">
                <div class="alert alert-info text-center" style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); color: rgba(255, 255, 255, 0.9); border-radius: 15px;">
                    <i class="fas fa-search me-2"></i>
                    Результаты поиска по запросу: <strong>"{{ search_query }}"</strong>
                    {% if page_obj %}
                        (найдено {{ page_obj.paginator.count }} {{ page_obj.paginator.count|pluralize:"проект,проекта,проектов" }})
                    {% endif %}
                    <a href="{% url 'main:portfolio_list' %}#portfolio" class="btn btn-sm btn-outline-secondary ms-3" style="color: #6366f1; border-color: #6366f1;">
                        <i class="fas fa-times me-1"></i> Очистить поиск
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Все работы портфолио -->
<section class="section-modern" id="portfolio">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-5" style="color: #ffffff; font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #6366f1, #ec4899); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Все работы</h2>
                
                {% if page_obj %}
                <!-- Сетка всех работ -->
                <div class="portfolio-grid-modern">
                    {% for project in page_obj %}
                    <div class="portfolio-card-modern">
                        <div class="portfolio-card-image-container">
                            {% if project.main_image %}
                            <img src="{{ project.main_image.url }}" alt="{{ project.get_main_image_alt }}" class="portfolio-card-image">
                            {% else %}
                            <div class="portfolio-card-placeholder">
                                <i class="fas fa-image portfolio-placeholder-icon"></i>
                            </div>
                            {% endif %}
                            <div class="portfolio-card-overlay">
                                <div class="portfolio-card-actions">
                                    <a href="{{ project.get_absolute_url }}" class="portfolio-card-btn">
                                        <i class="fas fa-eye me-2"></i>Подробнее
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="portfolio-card-content">
                            <div class="portfolio-card-meta">
                                <div class="portfolio-card-type">{{ project.get_project_type_display_ru }}</div>
                                {% if project.client_name %}
                                <div class="portfolio-card-client">{{ project.client_name }}</div>
                                {% endif %}
                            </div>
                            <h3 class="portfolio-card-title">
                                <a href="{{ project.get_absolute_url }}">{{ project.title }}</a>
                            </h3>
                            <p class="portfolio-card-description">{{ project.short_description }}</p>
                            
                            <a href="{{ project.get_absolute_url }}" class="portfolio-card-link">
                                Смотреть проект <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center" style="color: rgba(255, 255, 255, 0.6); font-size: 1.2rem; grid-column: 1 / -1;">
                        <i class="fas fa-search mb-3" style="font-size: 3rem; opacity: 0.3;"></i>
                        <p>В этом разделе пока нет опубликованных проектов.</p>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Пагинация -->
                {% if is_paginated %}
                <div class="portfolio-pagination-modern">
                    {% if page_obj.has_previous %}
                        <a href="?page=1{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            <i class="fas fa-chevron-left me-1"></i>Первая
                        </a>
                        <a href="?page={{ page_obj.previous_page_number }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            <i class="fas fa-chevron-left me-1"></i>Предыдущая
                        </a>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <span class="portfolio-page-link-modern active">{{ num }}</span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <a href="?page={{ num }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            Следующая<i class="fas fa-chevron-right ms-1"></i>
                        </a>
                        <a href="?page={{ page_obj.paginator.num_pages }}{% if current_type %}&type={{ current_type }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}#portfolio" class="portfolio-page-link-modern">
                            Последняя<i class="fas fa-chevron-right ms-1"></i>
                        </a>
                    {% endif %}
                </div>
                {% endif %}
                
                {% else %}
                <div class="text-center">
                    <div class="empty-portfolio">
                        <i class="fas fa-briefcase fa-5x text-muted mb-3"></i>
                        <h3>Портфолио пока пусто</h3>
                        <p class="text-muted">Мы работаем над добавлением наших лучших проектов. Скоро здесь появятся примеры наших работ!</p>
                        <a href="{% url 'main:contacts' %}" class="btn btn-primary">
                            <i class="fas fa-handshake me-2"></i>
                            Обсудить ваш проект
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- CTA секция -->
<section class="service-cta-modern">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h3 class="service-cta-title">Готовы обсудить ваш проект?</h3>
                <p class="service-cta-text">Свяжитесь с нами, и мы расскажем, как можем помочь вашему бизнесу расти в интернете.</p>
                <a href="{% url 'main:contacts' %}" class="service-cta-btn">
                    <i class="fas fa-phone me-2"></i>Связаться с нами
                </a>
            </div>
        </div>
    </div>
</section>

{% block extra_js %}
<script src="{% static 'js/portfolio.js' %}"></script>
{% endblock extra_js %}

{% endblock content %}